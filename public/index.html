<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Binance Clone</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background-color:#0b0b14; color:#fff; }
  header { padding:10px 20px; background:#0d0d1a; display:flex; justify-content:space-between; align-items:center; }
  header h1 { margin:0; font-size:1.5rem; }
  main { display:flex; flex-wrap:wrap; padding:10px; }
  #chart { flex:2 1 600px; height:400px; }
  .sidebar { flex:1 1 300px; padding:10px; background:#121224; margin-left:10px; }
  select, button { padding:5px 10px; margin:5px 0; }
  table { width:100%; border-collapse:collapse; margin:10px 0; }
  td, th { padding:4px; text-align:right; }
  th { border-bottom:1px solid #555; }
  .price-buy { color:#00a859; }
  .price-sell { color:#f6465d; }
  #balances div { margin:4px 0; }
</style>
<link rel="stylesheet" href="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js">
</head>
<body>

<header>
  <h1>My Binance Clone</h1>
  <div>
    <label for="pairSelect">Pair:</label>
    <select id="pairSelect"></select>
  </div>
</header>

<main>
  <div id="chart"></div>

  <div class="sidebar">
    <h2>Order Book</h2>
    <table>
      <thead><tr><th>Price</th><th>Amount</th></tr></thead>
      <tbody id="orderbookBody"></tbody>
    </table>

    <h2>Recent Trades</h2>
    <table>
      <thead><tr><th>Price</th><th>Amount</th></tr></thead>
      <tbody id="tradesBody"></tbody>
    </table>

    <h2>Balances</h2>
    <div id="balances"></div>

    <div>
      <button id="buyBtn">Buy</button>
      <button id="sellBtn">Sell</button>
    </div>
  </div>
</main>

<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script>
// ---------------- CHART ----------------
const chartDiv = document.getElementById('chart');
const chart = LightweightCharts.createChart(chartDiv, { 
  width: chartDiv.clientWidth, 
  height: chartDiv.clientHeight, 
  layout: { backgroundColor: '#0b0b14', textColor: '#fff' }, 
  grid: { vertLines: { color: '#1f1f2a' }, horzLines: { color: '#1f1f2a' } }, 
  crosshair: { mode: LightweightCharts.CrosshairMode.Normal }
});
const candleSeries = chart.addCandlestickSeries({ upColor: '#00a859', downColor: '#f6465d', borderVisible: false, wickUpColor: '#00a859', wickDownColor: '#f6465d' });

// ---------------- PAIRS ----------------
const topPairs = ["BTCUSDT","ETHUSDT","SOLUSDT","BNBUSDT","ADAUSDT","XRPUSDT","DOGEUSDT","DOTUSDT","AVAXUSDT","LTCUSDT"];
const pairSelect = document.getElementById('pairSelect');
pairSelect.innerHTML = topPairs.map(p => `<option value="${p}">${p.slice(0,-4)}/${p.slice(-4)}</option>`).join('');
let currentPair = pairSelect.value;
pairSelect.addEventListener('change', () => { currentPair = pairSelect.value; refreshOrderBook(prices); refreshTrades(prices); });

// ---------------- ORDERBOOK/TRADES ----------------
const orderbookBody = document.getElementById('orderbookBody');
const tradesBody = document.getElementById('tradesBody');
function refreshOrderBook(pricesData) {
  orderbookBody.innerHTML = '';
  for(let i=0;i<10;i++){
    const price = (pricesData[currentPair] * (1 + (Math.random()-0.5)/50)).toFixed(2);
    const amount = (Math.random()*2).toFixed(3);
    orderbookBody.innerHTML += `<tr><td class="${i%2===0?'price-buy':'price-sell'}">${price}</td><td>${amount}</td></tr>`;
  }
}
function refreshTrades(pricesData) {
  tradesBody.innerHTML = '';
  for(let i=0;i<10;i++){
    const price = (pricesData[currentPair] * (1 + (Math.random()-0.5)/50)).toFixed(2);
    const amount = (Math.random()*2).toFixed(3);
    tradesBody.innerHTML += `<tr><td class="${i%2===0?'price-buy':'price-sell'}">${price}</td><td>${amount}</td></tr>`;
  }
}

// ---------------- BALANCES ----------------
const balancesDiv = document.getElementById('balances');
const balances = { USDT: 1000, BTC: 0.5, ETH: 1.2, SOL: 10 };
function refreshBalances() {
  balancesDiv.innerHTML = '';
  for(const key in balances){
    balancesDiv.innerHTML += `<div>${key}: ${balances[key]}</div>`;
  }
}
refreshBalances();

// ---------------- FETCH PRICES ----------------
let prices = {};
async function fetchPrices() {
  try {
    const res = await fetch('/api/prices');
    prices = await res.json();
    refreshOrderBook(prices);
    refreshTrades(prices);
    
    // Update chart with demo candlestick
    const lastPrice = prices[currentPair];
    const now = Math.floor(Date.now()/1000);
    candleSeries.update({ time: now, open: lastPrice*0.995, high: lastPrice*1.005, low: lastPrice*0.995, close: lastPrice });
  } catch(err) { console.error(err); }
}
fetchPrices();
setInterval(fetchPrices, 1500);

// ---------------- BUY/SELL ----------------
document.getElementById('buyBtn').addEventListener('click', ()=>alert('Buy clicked'));
document.getElementById('sellBtn').addEventListener('click', ()=>alert('Sell clicked'));

// ---------------- RESIZE ----------------
window.addEventListener('resize', ()=>chart.applyOptions({ width: chartDiv.clientWidth, height: chartDiv.clientHeight }));
</script>

</body>
</html>
