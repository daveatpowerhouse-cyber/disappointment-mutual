<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Disappointment Mutual Exchange - Live Trading</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; overflow-x: hidden; }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
    .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #2b3139; border-radius: 3px; }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #3d4450; }
    .orderbook-row { position: relative; }
    .orderbook-row:hover { background: rgba(43, 49, 57, 0.3) !important; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // **API URL automatically uses current domain** (works locally and on Railway)
    const API_URL = window.location.origin;

    // API Client
    const API = {
      async register(username, password) {
        const res = await fetch(`${API_URL}/api/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        return res.json();
      },
      async login(username, password) {
        const res = await fetch(`${API_URL}/api/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        return res.json();
      },
      async getUser(username) {
        const res = await fetch(`${API_URL}/api/user/${username}`);
        return res.json();
      },
      async placeOrder(orderData) {
        const res = await fetch(`${API_URL}/api/orders`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderData)
        });
        return res.json();
      },
      async getOrders(pair, status) {
        let url = `${API_URL}/api/orders?`;
        if (pair) url += `pair=${pair}&`;
        if (status) url += `status=${status}`;
        const res = await fetch(url);
        return res.json();
      },
      async cancelOrder(orderId, username) {
        const res = await fetch(`${API_URL}/api/orders/${orderId}/cancel`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        return res.json();
      },
      async getTrades(pair, limit = 50) {
        const res = await fetch(`${API_URL}/api/trades?pair=${pair || ''}&limit=${limit}`);
        return res.json();
      },
      async getAllUsers() {
        const res = await fetch(`${API_URL}/api/admin/users`);
        return res.json();
      }
    };

    // Price API (stays the same, external CoinGecko)
    const PriceAPI = {
      async fetchPrices() {
        try {
          const response = await fetch(
            'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,binancecoin,cardano,ripple,dogecoin,polkadot&vs_currencies=usd&include_24hr_change=true'
          );
          const data = await response.json();
          return {
            BTCUSDT: data.bitcoin?.usd || 0,
            ETHUSDT: data.ethereum?.usd || 0,
            SOLUSDT: data.solana?.usd || 0,
            BNBUSDT: data.binancecoin?.usd || 0,
            ADAUSDT: data.cardano?.usd || 0,
            XRPUSDT: data.ripple?.usd || 0,
            DOGEUSDT: data.dogecoin?.usd || 0,
            DOTUSDT: data.polkadot?.usd || 0,
            changes: {
              BTCUSDT: data.bitcoin?.usd_24h_change || 0,
              ETHUSDT: data.ethereum?.usd_24h_change || 0,
              SOLUSDT: data.solana?.usd_24h_change || 0,
              BNBUSDT: data.binancecoin?.usd_24h_change || 0,
              ADAUSDT: data.cardano?.usd_24h_change || 0,
              XRPUSDT: data.ripple?.usd_24h_change || 0,
              DOGEUSDT: data.dogecoin?.usd_24h_change || 0,
              DOTUSDT: data.polkadot?.usd_24h_change || 0,
            }
          };
        } catch (error) {
          console.error('Error fetching prices:', error);
          return null;
        }
      }
    };

    // ... the rest of your React code (AuthScreen, AdminPanel, CryptoExchange, App) remains **exactly the same**.
    // Only difference: all API calls now use API_URL = window.location.origin

    function App() {
      const [currentUser, setCurrentUser] = useState(null);

      const handleLogin = (user) => setCurrentUser(user);
      const handleLogout = () => setCurrentUser(null);

      return currentUser ? (
        <CryptoExchange user={currentUser} onLogout={handleLogout} />
      ) : (
        <AuthScreen onLogin={handleLogin} />
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
